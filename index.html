<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>RekietaLabs Support - Create Ticket</title>
<style>
  :root {
    --brand-color: #1753aa;
    --bg-color: #121212;
    --text-color: #eee;
    --input-bg: #1e1e1e;
    --input-border: #333;
    --button-bg: var(--brand-color);
    --button-hover-bg: #0f3d7d;
    --error-color: #f44336;
  }
  body {
    margin: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: var(--bg-color); color: var(--text-color);
    display: flex; flex-direction: column; align-items: center; min-height: 100vh;
    padding: 20px;
  }
  header {
    font-size: 2rem; margin-bottom: 20px; font-weight: bold; color: var(--brand-color);
  }
  form {
    background: #222; padding: 20px; border-radius: 8px; width: 100%; max-width: 480px;
    box-shadow: 0 0 15px rgba(23, 83, 170, 0.5);
  }
  label {
    display: block; margin-bottom: 6px; font-weight: 600;
  }
  input, textarea, select {
    width: 100%; padding: 10px; margin-bottom: 15px;
    background: var(--input-bg); border: 1px solid var(--input-border);
    border-radius: 4px; color: var(--text-color); font-size: 1rem;
    resize: vertical;
  }
  button {
    width: 100%; background: var(--button-bg); border: none;
    padding: 12px; font-size: 1.1rem; color: #fff; border-radius: 4px;
    cursor: pointer; transition: background 0.3s ease;
  }
  button:hover {
    background: var(--button-hover-bg);
  }
  .error {
    color: var(--error-color); margin-bottom: 10px; font-weight: 700;
  }
  .success {
    color: #4caf50; margin-bottom: 10px; font-weight: 700;
  }
  footer {
    margin-top: auto; font-size: 0.8rem; color: #555;
  }
  a {
    color: var(--brand-color);
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>
</head>
<body>
<header>RekietaLabs Support</header>

<form id="ticketForm" novalidate>
  <div id="formMessage"></div>

  <label for="creator_name">Your Name (optional)</label>
  <input type="text" id="creator_name" name="creator_name" placeholder="Your name" />

  <label for="creator_email" required>Your Email</label>
  <input type="email" id="creator_email" name="creator_email" placeholder="you@example.com" required />

  <label for="subject" required>Subject</label>
  <input type="text" id="subject" name="subject" placeholder="Ticket subject" required />

  <label for="description" required>Description</label>
  <textarea id="description" name="description" rows="6" placeholder="Explain your issue or request..." required></textarea>

  <label for="priority">Priority</label>
  <select id="priority" name="priority">
    <option value="normal" selected>Normal</option>
    <option value="low">Low</option>
    <option value="high">High</option>
    <option value="urgent">Urgent</option>
  </select>

  <button type="submit">Create Ticket</button>
</form>

<footer>
  <p>After submitting, you will receive an email with your ticket login link and credentials.</p>
</footer>

<script>
  const apiBase = 'https://api.rekietalabs.com/functions/tickets';

  const form = document.getElementById('ticketForm');
  const formMessage = document.getElementById('formMessage');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    formMessage.textContent = '';
    formMessage.className = '';

    const data = {
      creator_name: form.creator_name.value.trim(),
      creator_email: form.creator_email.value.trim(),
      subject: form.subject.value.trim(),
      description: form.description.value.trim(),
      priority: form.priority.value,
    };

    // Basic validation
    if (!data.creator_email || !data.subject || !data.description) {
      formMessage.textContent = 'Please fill in all required fields.';
      formMessage.className = 'error';
      return;
    }

    try {
      const response = await fetch(`${apiBase}/create`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data),
      });

      const result = await response.json();

      if (!response.ok) {
        formMessage.textContent = result.error || 'Failed to create ticket.';
        formMessage.className = 'error';
        return;
      }

      formMessage.textContent = `Ticket created successfully! Your Ticket ID: ${result.ticketId}. Please check your email for login details.`;
      formMessage.className = 'success';

      form.reset();
    } catch (err) {
      formMessage.textContent = 'Network error: unable to contact support API.';
      formMessage.className = 'error';
    }
  });
</script>
</body>
</html>
